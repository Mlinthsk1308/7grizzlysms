(window.webpackJsonp=window.webpackJsonp||[]).push([[240],{1092:function(t,e,r){t.exports={}},1250:function(t,e,r){"use strict";r(1092)},1460:function(t,e,r){"use strict";r.r(e);r(20),r(22),r(15),r(13),r(25),r(38);var o=r(3),n=r(0),l=(r(11),r(125),r(66),r(12),r(34),r(165)),c=r(51),m=r(1091);function d(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function h(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var f,v,x={name:"Authorization",components:{Breadcrumbs:r(347).default},data:function(){return{form:{username:"",password:"",token:""},blockErrorMessage:"",isSubmiting:!1,isNeedTwoFactor:!1,countErrorsTwoFactor:0}},validations:function(){var form={username:{required:l.required,email:l.email},password:{required:l.required,minLength:Object(l.minLength)(6)}};return this.isNeedTwoFactor&&(form.token={required:l.required}),{form:form}},mixins:[c.f,m.a,c.e,c.b],layout:"custom-layout",computed:{getBreadcrumbs:function(){return[{path:"/",title:this.$t("breadcrumbs.homePage")},{path:this.$route.path,title:this.$t("authorization.title")}]},isRecaptchaTest:function(){var t,e,r,o;return Boolean(Number.parseFloat((null===(t=this.$store)||void 0===t||null===(e=t.state)||void 0===e||null===(r=e.appState)||void 0===r||null===(o=r.config)||void 0===o?void 0:o.useReCaptchaForAuth)||0))}},methods:{onAuthorization:(v=Object(n.a)(regeneratorRuntime.mark((function t(){var e,r,o,n,data,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.$v.$touch(),!this.$v.$invalid){t.next=3;break}return t.abrupt("return",null);case 3:if(o=h({},this.form),!this.isRecaptchaTest){t.next=10;break}return t.next=7,this.$recaptcha.getResponse().then((function(t){return t})).catch((function(){return""}));case 7:return o["g-recaptcha-response"]=t.sent,t.next=10,this.$recaptcha.reset();case 10:return this.isSubmiting=!0,t.next=13,this.$api.agent.transport.post("users/login",o).catch((function(t){var e,r;return{data:{errorMessage:(null===(e=t.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r[0])||"Ошибка сервера"}}}));case 13:if(n=t.sent,data=n.data,"block"!==(null===(e=data.errorMessage)||void 0===e?void 0:e.field)){t.next=19;break}return this.isSubmiting=!1,this.blockErrorMessage=null===(l=data.errorMessage)||void 0===l?void 0:l.message,t.abrupt("return");case 19:if(null==data||null===(r=data.errorMessage)||void 0===r||!r.message){t.next=23;break}return this.isSubmiting=!1,this.$toast.error(null==data?void 0:data.errorMessage.message),t.abrupt("return",null);case 23:if(!data.need_two_factor){t.next=28;break}return this.isSubmiting=!1,this.isNeedTwoFactor=!0,this.$toast.success(data.message),t.abrupt("return",!1);case 28:return this.setToken({authToken:data.token}),this.$cookies.set("authToken",data.token,{path:"/",expires:new Date((new Date).setFullYear((new Date).getFullYear()+5))}),t.next=32,this.getUser();case 32:this.isSubmiting=!0,this.$router.replace(this.localePath("/profile"));case 34:case"end":return t.stop()}}),t,this)}))),function(){return v.apply(this,arguments)}),onLoginTwoFactor:(f=Object(n.a)(regeneratorRuntime.mark((function t(){var data,e,r,o,n,l,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.$v.$touch(),!this.$v.$invalid){t.next=3;break}return t.abrupt("return",null);case 3:return this.isSubmiting=!0,t.next=6,this.$api.agent.transport.post("/users/login/two-factor",{token:this.form.token}).then((function(t){return t.data})).catch((function(t){return{error:t.response}}));case 6:if(!(data=t.sent).error){t.next=18;break}if(this.isSubmiting=!1,c=(null===(e=data.error)||void 0===e||null===(r=e.data)||void 0===r||null===(o=r[0])||void 0===o?void 0:o.message)||(null===(n=data.error)||void 0===n||null===(l=n.data)||void 0===l?void 0:l.message)||"Ошибка сервера",this.$toast.error(c),!(this.countErrorsTwoFactor>=3)){t.next=16;break}return this.countErrorsTwoFactor=0,this.isNeedTwoFactor=!1,this.isSubmiting=!1,t.abrupt("return");case 16:return this.countErrorsTwoFactor=this.countErrorsTwoFactor+1,t.abrupt("return");case 18:return this.setToken({authToken:data.token}),this.$cookies.set("authToken",data.token,{path:"/",expires:new Date((new Date).setFullYear((new Date).getFullYear()+5))}),t.next=22,this.getUser();case 22:return this.isSubmiting=!0,t.next=25,this.$router.replace(this.localePath("/profile"));case 25:case"end":return t.stop()}}),t,this)}))),function(){return f.apply(this,arguments)})}},w=x,_=(r(1250),r(5)),component=Object(_.a)(w,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"mx-auto px-4 md:px-0 max-w-4xl mt-4 md:mt-6"},[r("div",{staticClass:"flex flex-col"},[r("Breadcrumbs",{attrs:{breadcrumbs:t.getBreadcrumbs}}),t._v(" "),r("div",{staticClass:"mt-0 md:mt-9 w-full mb-2 md:mb-12 text-center"},[r("p",{staticClass:"text-2xl sm:text-[32px] font-semibold"},[t._v(t._s(t.$t("authorization.title")))])]),t._v(" "),r("div",{staticClass:"w-full bg-base-200 rounded-lg py-4 md:py-10 mb-4 px-4 md:px-0"},[r("form",{staticClass:"flex flex-col items-center",attrs:{autocomplete:"off",action:"javascript:void(0);"}},[r("div",{staticClass:"w-full md:w-3/5 mb-3 md:mb-5"},[t.$v.form.username.$dirty?r("span",{staticClass:"text-error text-[11px] sm:text-xs mt-2"},[t.$v.form.username.required?t.$v.form.username.email?t._e():r("span",[t._v(t._s(t.$t("errorsValidationForms.emailErrorMessage")))]):r("span",[t._v(t._s(t.$t("errorsValidationForms.requiredForFill")))])]):t._e(),t._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:t.form.username,expression:"form.username"}],staticClass:"tm-text__invert h-11 sm:h-12 input focus:ring-0 py-[10px] pr-14 bg-secondary w-full border-2 border-transparent hover:border-primary rounded-md",attrs:{placeholder:t.$t("authorization.emailInputPlaceholder"),disabled:t.isNeedTwoFactor,type:"text",autocomplete:"off"},domProps:{value:t.form.username},on:{input:function(e){e.target.composing||t.$set(t.form,"username",e.target.value)}}})]),t._v(" "),r("div",{staticClass:"w-full md:w-3/5 mb-3 md:mb-5"},[t.$v.form.password.$dirty?r("span",{staticClass:"text-error text-[11px] sm:text-xs mt-2"},[t.$v.form.password.required?t.$v.form.password.$dirty&&!t.$v.form.password.minLength?r("span",{staticClass:"text-error text-[11px] sm:text-xs"},[t._v(t._s(t.$t("errorsValidationForms.requaredLengthMessage"))+" "+t._s(t.$v.form.password.$params.minLength.min))]):t._e():r("span",[t._v(t._s(t.$t("errorsValidationForms.requiredForFill")))])]):t._e(),t._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:t.form.password,expression:"form.password"}],staticClass:"tm-text__invert h-11 sm:h-12 input focus:ring-0 py-[10px] pr-14 bg-secondary w-full border-2 border-transparent hover:border-primary rounded-md",attrs:{placeholder:t.$t("authorization.passwordInputPlaceholder"),disabled:t.isNeedTwoFactor,type:"password",autocomplete:"off"},domProps:{value:t.form.password},on:{input:function(e){e.target.composing||t.$set(t.form,"password",e.target.value)}}})]),t._v(" "),t.isNeedTwoFactor?r("div",{staticClass:"w-full md:w-3/5 mb-3 md:mb-5"},[t.$v.form.token.$dirty?r("span",{staticClass:"text-error text-[11px] sm:text-xs mt-2"},[t.$v.form.token.required?t._e():r("span",[t._v(t._s(t.$t("errorsValidationForms.requiredForFill")))])]):t._e(),t._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:t.form.token,expression:"form.token"}],staticClass:"tm-text__invert h-11 sm:h-12 input focus:ring-0 py-[10px] pr-14 bg-secondary w-full border-2 border-transparent hover:border-primary rounded-md",attrs:{placeholder:t.$t("authorization.tokenInputPlaceholder"),autocomplete:"off"},domProps:{value:t.form.token},on:{input:function(e){e.target.composing||t.$set(t.form,"token",e.target.value)}}})]):t._e(),t._v(" "),r("div",{staticClass:"w-full md:w-3/5 md:mb-5 flex justify-start mb-6"},[r("nuxt-link",{staticClass:"text-base text-primary font-semibold opacity-1 hover:opacity-80",attrs:{to:t.localePath("/request-password")}},[t._v(t._s(t.$t("authorization.forgotPassword"))+"\n          ")])],1),t._v(" "),t.isRecaptchaTest?[r("div",{staticClass:"flex items-center justify-center border-b py-8"},[r("recaptcha")],1)]:t._e(),t._v(" "),[t.isNeedTwoFactor?t._e():r("button",{staticClass:"h-10 md:h-12 min-h-[40px] w-full md:w-3/5 mb-3 md:mb-5 btn btn-primary",attrs:{disabled:t.isSubmiting},on:{click:t.onAuthorization}},[t._v(t._s(t.isSubmiting?t.$t("authorization.buttonRegistrating"):t.$t("authorization.buttonRegistration"))+"\n          ")]),t._v(" "),t.isNeedTwoFactor?r("button",{staticClass:"h-10 md:h-12 min-h-[40px] w-full md:w-3/5 mb-3 md:mb-5 btn btn-primary",attrs:{disabled:t.isSubmiting},on:{click:t.onLoginTwoFactor}},[t._v(t._s(t.isSubmiting?t.$t("authorization.buttonRegistrating"):t.$t("authorization.buttonRegistration"))+"\n          ")]):t._e(),t._v(" "),this.blockErrorMessage?r("div",{staticClass:"block-error-message w-full md:w-3/5 mb-3 md:mb-5"},[t._v("\n            "+t._s(this.blockErrorMessage)+"\n          ")]):t._e()]],2)]),t._v(" "),r("div",{staticClass:"w-full bg-base-200 rounded-lg flex justify-center items-center py-4 md:py-8"},[r("div",{staticClass:"text-center font-semibold text-base md:text-xl"},[r("span",[t._v(t._s(t.$t("authorization.newUser")))]),t._v(" "),r("nuxt-link",{attrs:{to:t.localePath("/registration")}},[t._v(t._s(t.$t("authorization.registration")))])],1)])],1)])}),[],!1,null,"5e9c2266",null);e.default=component.exports}}]);
//# sourceMappingURL=index-39c5f30.js.map